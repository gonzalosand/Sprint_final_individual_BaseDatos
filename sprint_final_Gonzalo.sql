-- MySQL Script generated by MySQL Workbench
-- Tue Oct  5 22:15:54 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema en_que_puedo_ayudarte
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema en_que_puedo_ayudarte
-- -----------------------------------------------------
/* Construya una base de datos. */
CREATE SCHEMA IF NOT EXISTS `en_que_puedo_ayudarte` DEFAULT CHARACTER SET utf8 ;
USE `en_que_puedo_ayudarte` ;

-- -----------------------------------------------------
-- Table `en_que_puedo_ayudarte`.`usuario`
-- -----------------------------------------------------

/*  Construya las tablas */
CREATE TABLE IF NOT EXISTS `en_que_puedo_ayudarte`.`usuario` (
  `idusuario` INT NOT NULL,
  `nombre` VARCHAR(45) NULL,
  `apellido` VARCHAR(45) NULL,
  `edad` INT NULL,
  `correo` VARCHAR(45) NULL,
  `numero_ingresos` VARCHAR(45) NULL DEFAULT '1',
  PRIMARY KEY (`idusuario`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `en_que_puedo_ayudarte`.`operarios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `en_que_puedo_ayudarte`.`operarios` (
  `idoperarios` INT NOT NULL,
  `nombre` VARCHAR(45) NULL,
  `apellido` VARCHAR(45) NULL,
  `edad` INT NULL,
  `correo` VARCHAR(45) NULL,
  `numero_soporte` INT NULL DEFAULT 1,
  PRIMARY KEY (`idoperarios`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `en_que_puedo_ayudarte`.`soporte`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `en_que_puedo_ayudarte`.`soporte` (
  `idusuario` INT NOT NULL,
  `idoperarios` INT NOT NULL,
  `fecha` DATE NULL,
  `evaluacion` INT NULL,
  PRIMARY KEY (`idusuario`, `idoperarios`),
  INDEX `fk_operarios_idx` (`idoperarios` ASC) VISIBLE,
  CONSTRAINT `fk_usuario`
    FOREIGN KEY (`idusuario`)
    REFERENCES `en_que_puedo_ayudarte`.`usuario` (`idusuario`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_operarios`
    FOREIGN KEY (`idoperarios`)
    REFERENCES `en_que_puedo_ayudarte`.`operarios` (`idoperarios`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


/*Asigne un usuario con todos los privilegios.*/
CREATE USER 'sprint_final'@'localhost' IDENTIFIED BY 'gonzalo2021*';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP
    ON en_que_puedo_ayudarte
    TO 'sprint_final'@'localhost';
    
    
    
/*Insercion de 5 usuarios*/
INSERT INTO `en_que_puedo_ayudarte`.`usuario` (`idusuario`, `nombre`, `apellido`, `edad`, `correo`, `numero_ingresos`) VALUES ('1', 'victor', 'jara', '25', 'victorjara@gmail.com', '2');
INSERT INTO `en_que_puedo_ayudarte`.`usuario` (`idusuario`, `nombre`, `apellido`, `edad`, `correo`, `numero_ingresos`) VALUES ('2', 'manuel', 'inostroza', '26', 'ino@gmail.com', '3');
INSERT INTO `en_que_puedo_ayudarte`.`usuario` (`idusuario`, `nombre`, `apellido`, `edad`, `correo`, `numero_ingresos`) VALUES ('3', 'alexandra', 'alarcon', '28', 'aleale@hormail.com', '2');
INSERT INTO `en_que_puedo_ayudarte`.`usuario` (`idusuario`, `nombre`, `apellido`, `edad`, `correo`, `numero_ingresos`) VALUES ('4', 'javiera', 'larrain', '21', 'model@hotmail.com', '1');
INSERT INTO `en_que_puedo_ayudarte`.`usuario` (`idusuario`, `nombre`, `apellido`, `edad`, `correo`, `numero_ingresos`) VALUES ('5', 'luis', 'quezada', '34', 'luisquezada@gmail.com', '6');
select * from usuario;

/*Insercion de 5 operarios*/
INSERT INTO `en_que_puedo_ayudarte`.`operarios` (`idoperarios`, `nombre`, `apellido`, `edad`, `correo`, `numero_soporte`) VALUES ('1', 'miguel', 'ruiz', '32', 'soporte1@soporte.com', '2');
INSERT INTO `en_que_puedo_ayudarte`.`operarios` (`idoperarios`, `nombre`, `apellido`, `edad`, `correo`, `numero_soporte`) VALUES ('2', 'oscar', 'benavidez', '34', 'soporte2@soporte.com', '3');
INSERT INTO `en_que_puedo_ayudarte`.`operarios` (`idoperarios`, `nombre`, `apellido`, `edad`, `correo`, `numero_soporte`) VALUES ('3', 'raul', 'retamales', '36', 'soporte3@soporte.com', '1');
INSERT INTO `en_que_puedo_ayudarte`.`operarios` (`idoperarios`, `nombre`, `apellido`, `edad`, `correo`, `numero_soporte`) VALUES ('4', 'mario', 'pradenas', '31', 'soporte4@soporte.com', '4');
INSERT INTO `en_que_puedo_ayudarte`.`operarios` (`idoperarios`, `nombre`, `apellido`, `edad`, `correo`, `numero_soporte`) VALUES ('5', 'juan', 'sandoval', '39', 'soporte5@soporte.com', '4');
select * from operarios;

/*Insercion de 10 soporte*/
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('4', '4', '2021/06/20', '3');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('5', '5', '2021/07/27', '5');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('5', '4', '2021/08/14', '6');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('5', '2', '2021/09/19', '2');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('5', '3', '2021/09/28', '3');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('5', '1', '2021/10/20', '4');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('3', '2', '2021/10/24', '5');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('2', '2', '2021/10/17', '6');
INSERT INTO `en_que_puedo_ayudarte`.`soporte` (`idusuario`, `idoperarios`, `fecha`, `evaluacion`) VALUES ('3', '3', '2021/10/20', '5');
select * from soporte;


/*Seleccione las 3 operaciones con mejor evaluación.*/
select idoperarios as operaciones_mejor_evaluadas, evaluacion
from soporte order by evaluacion desc limit 3;


/*Seleccione las 3 operaciones con menos evaluación.*/
select idoperarios as operaciones_peor_evaluadas, evaluacion
from soporte order by evaluacion asc limit 3;

/*Seleccione al operario que más soportes ha realizado.*/
select nombre, apellido, numero_soporte from operarios where numero_soporte = (select max(numero_soporte) from operarios);

/*Seleccione al cliente que menos veces ha utilizado la aplicación.*/
select nombre, apellido, numero_ingresos from usuario where numero_ingresos = (select max(numero_ingresos) from usuario);

/*Agregue 10 años a los tres primeros usuarios registrados.*/

update usuario set edad = edad + 10 where idusuario in 
(1,2,3);

/*Renombre todas las columnas ‘correo electrónico’. El nuevo nombre debe ser email.*/
select * from usuario;
alter table usuario rename column correo to email;
select * from operarios;
alter table operarios rename column correo to email;

/*Seleccione solo los operarios mayores de 20 años.*/
select nombre, apellido, edad from operarios where edad > 20;